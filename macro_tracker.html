<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Macro Tracker</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; color: #e2e8f0; height: 100vh; overflow: hidden; }

  .app { display: flex; height: 100vh; }

  /* LEFT PANEL — Daily Tracker */
  .daily-panel {
    width: 680px; min-width: 280px; max-width: 80vw; background: #1e293b; border-right: 1px solid #334155;
    display: flex; flex-direction: column; overflow: hidden; position: relative;
  }
  .resize-handle {
    position: absolute; top: 0; right: -4px; width: 8px; height: 100%;
    cursor: col-resize; z-index: 10; background: transparent;
    transition: background 0.15s;
  }
  .resize-handle:hover, .resize-handle.active { background: #3b82f6; }
  .daily-panel h2 {
    padding: 16px 20px 12px; font-size: 15px; text-transform: uppercase; letter-spacing: 1.2px;
    color: #94a3b8; border-bottom: 1px solid #334155; flex-shrink: 0;
  }
  .daily-items { flex: 1; overflow-y: auto; padding: 8px 12px; }
  .daily-item {
    background: #273548; border-radius: 8px; padding: 10px 14px; margin-bottom: 6px;
    display: flex; justify-content: space-between; align-items: center; font-size: 13px;
    border: 1px solid #334155; transition: background 0.15s;
  }
  .daily-item:hover { background: #2d3f54; }
  .daily-item .item-name { font-weight: 600; color: #f1f5f9; max-width: 260px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .daily-item .item-amount { color: #94a3b8; font-size: 11px; }
  .daily-item .item-macros { display: flex; gap: 8px; font-size: 11px; }
  .daily-item .item-macros span { padding: 2px 6px; border-radius: 4px; font-weight: 600; }
  .macro-cal { background: #422006; color: #fb923c; }
  .macro-pro { background: #052e16; color: #4ade80; }
  .macro-carb { background: #1e1b4b; color: #a78bfa; }
  .macro-fat { background: #4c0519; color: #fb7185; }
  .daily-item .remove-btn {
    background: none; border: none; color: #64748b; cursor: pointer; font-size: 16px;
    padding: 0 4px; line-height: 1; transition: color 0.15s;
  }
  .daily-item .remove-btn:hover { color: #f87171; }

  .daily-totals {
    border-top: 1px solid #334155; padding: 14px 20px; flex-shrink: 0; background: #162032;
  }
  .daily-totals h3 { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #64748b; margin-bottom: 10px; }
  .totals-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .total-box {
    border-radius: 8px; padding: 10px 12px; text-align: center;
  }
  .total-box .total-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 2px; }
  .total-box .total-value { font-size: 22px; font-weight: 700; }
  .total-cal { background: #422006; }
  .total-cal .total-label { color: #fdba74; }
  .total-cal .total-value { color: #fb923c; }
  .total-pro { background: #052e16; }
  .total-pro .total-label { color: #86efac; }
  .total-pro .total-value { color: #4ade80; }
  .total-carb { background: #1e1b4b; }
  .total-carb .total-label { color: #c4b5fd; }
  .total-carb .total-value { color: #a78bfa; }
  .total-fat { background: #4c0519; }
  .total-fat .total-label { color: #fda4af; }
  .total-fat .total-value { color: #fb7185; }

  .empty-state { text-align: center; padding: 40px 20px; color: #475569; }
  .empty-state .icon { font-size: 36px; margin-bottom: 12px; }
  .empty-state p { font-size: 13px; line-height: 1.5; }

  /* RIGHT PANEL */
  .right-panel { flex: 1; display: flex; flex-direction: column; overflow-y: auto; overflow-x: hidden; }

  /* TOP PANE — Ingredients + Amounts */
  .top-pane {
    flex: 1; display: flex; border-bottom: 2px solid #334155; min-height: 0;
  }

  /* Ingredient List */
  .ingredient-list {
    width: 280px; min-width: 280px; border-right: 1px solid #334155;
    display: flex; flex-direction: column; overflow: hidden; background: #1e293b;
  }
  .search-box {
    padding: 12px; border-bottom: 1px solid #334155; flex-shrink: 0;
  }
  .search-box input {
    width: 100%; padding: 8px 12px; border-radius: 6px; border: 1px solid #475569;
    background: #0f172a; color: #e2e8f0; font-size: 13px; outline: none;
    transition: border-color 0.15s;
  }
  .search-box input:focus { border-color: #3b82f6; }
  .search-box input::placeholder { color: #64748b; }
  .ingredient-scroll { flex: 1; overflow-y: auto; }
  .ingredient-btn {
    display: block; width: 100%; text-align: left; padding: 10px 16px;
    background: none; border: none; border-bottom: 1px solid #1a2536;
    color: #cbd5e1; font-size: 13px; cursor: pointer; transition: all 0.12s;
  }
  .ingredient-btn:hover { background: #273548; color: #f1f5f9; }
  .ingredient-btn.active { background: #1e3a5f; color: #60a5fa; font-weight: 600; border-left: 3px solid #3b82f6; }
  .ingredient-btn .cat-dot {
    display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 8px;
  }

  /* Amount List */
  .amount-panel {
    flex: 1; display: flex; flex-direction: column; overflow: hidden;
  }
  .amount-header {
    padding: 14px 20px; border-bottom: 1px solid #334155; flex-shrink: 0; background: #1a2744;
  }
  .amount-header h3 { font-size: 14px; color: #94a3b8; }
  .amount-header .sel-name { color: #60a5fa; font-weight: 700; font-size: 16px; margin-top: 2px; }
  .amount-scroll { flex: 1; overflow-y: auto; padding: 8px 12px; }
  .amount-btn {
    display: block; width: 100%; text-align: left; padding: 12px 16px; margin-bottom: 6px;
    background: #273548; border: 1px solid #334155; border-radius: 8px;
    color: #e2e8f0; font-size: 13px; cursor: pointer; transition: all 0.12s;
  }
  .amount-btn:hover { background: #2d4a6a; border-color: #3b82f6; }
  .amount-btn.active { background: #1e3a5f; border-color: #3b82f6; }
  .amount-btn .amt-label { font-weight: 600; }
  .amount-btn .amt-grams { color: #94a3b8; font-size: 11px; margin-left: 6px; }
  .no-selection { display: flex; align-items: center; justify-content: center; height: 100%; color: #475569; font-size: 14px; }

  /* BOTTOM PANE — Macro Preview + Save */
  .bottom-pane {
    height: 200px; min-height: 200px; background: #162032; display: flex; flex-direction: column;
    justify-content: center; align-items: center; padding: 20px;
  }
  .macro-preview { display: flex; gap: 16px; margin-bottom: 20px; }
  .macro-card {
    width: 120px; border-radius: 10px; padding: 14px; text-align: center;
  }
  .macro-card .mc-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
  .macro-card .mc-value { font-size: 26px; font-weight: 700; }
  .macro-card .mc-unit { font-size: 11px; color: #94a3b8; }
  .mc-cal { background: #422006; } .mc-cal .mc-label { color: #fdba74; } .mc-cal .mc-value { color: #fb923c; }
  .mc-pro { background: #052e16; } .mc-pro .mc-label { color: #86efac; } .mc-pro .mc-value { color: #4ade80; }
  .mc-carb { background: #1e1b4b; } .mc-carb .mc-label { color: #c4b5fd; } .mc-carb .mc-value { color: #a78bfa; }
  .mc-fat { background: #4c0519; } .mc-fat .mc-label { color: #fda4af; } .mc-fat .mc-value { color: #fb7185; }

  .save-btn {
    padding: 12px 48px; background: #2563eb; color: #fff; border: none; border-radius: 8px;
    font-size: 15px; font-weight: 700; cursor: pointer; transition: all 0.15s;
    letter-spacing: 0.5px;
  }
  .save-btn:hover { background: #1d4ed8; transform: translateY(-1px); }
  .save-btn:active { transform: translateY(0); }
  .save-btn:disabled { background: #334155; color: #64748b; cursor: default; transform: none; }

  .bottom-empty { color: #475569; font-size: 14px; text-align: center; }
  .bottom-empty .hint { font-size: 12px; margin-top: 6px; }

  /* PROFILE & GOALS PANE */
  .profile-pane {
    border-bottom: 2px solid #334155; padding: 14px 20px; flex-shrink: 0; background: #1a2235;
    overflow-y: auto; max-height: 320px;
  }
  .profile-pane h3 {
    font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #64748b; margin-bottom: 10px;
  }
  .profile-row { display: flex; align-items: center; margin-bottom: 10px; gap: 8px; flex-wrap: wrap; }
  .profile-row-label {
    font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.8px;
    width: 70px; flex-shrink: 0; font-weight: 600;
  }
  .pill-group { display: flex; gap: 4px; flex-wrap: wrap; }
  .pill-btn {
    padding: 5px 12px; border-radius: 20px; border: 1px solid #475569;
    background: #1e293b; color: #94a3b8; font-size: 12px; cursor: pointer;
    transition: all 0.12s; white-space: nowrap;
  }
  .pill-btn:hover { border-color: #60a5fa; color: #e2e8f0; }
  .pill-btn.active { background: #1e3a5f; border-color: #3b82f6; color: #60a5fa; font-weight: 600; }

  .target-display { display: flex; gap: 10px; margin-top: 12px; padding-top: 12px; border-top: 1px solid #334155; }
  .target-chip {
    flex: 1; border-radius: 8px; padding: 8px 10px; text-align: center;
  }
  .target-chip .tc-label { font-size: 9px; text-transform: uppercase; letter-spacing: 0.8px; }
  .target-chip .tc-value { font-size: 18px; font-weight: 700; }
  .target-chip .tc-unit { font-size: 10px; color: #94a3b8; }
  .tc-cal { background: #422006; } .tc-cal .tc-label { color: #fdba74; } .tc-cal .tc-value { color: #fb923c; }
  .tc-pro { background: #052e16; } .tc-pro .tc-label { color: #86efac; } .tc-pro .tc-value { color: #4ade80; }
  .tc-carb { background: #1e1b4b; } .tc-carb .tc-label { color: #c4b5fd; } .tc-carb .tc-value { color: #a78bfa; }
  .tc-fat { background: #4c0519; } .tc-fat .tc-label { color: #fda4af; } .tc-fat .tc-value { color: #fb7185; }
  .target-note { font-size: 10px; color: #475569; text-align: center; margin-top: 8px; font-style: italic; }

  /* CUSTOM MACRO ENTRY */
  .custom-entry-pane {
    border-bottom: 2px solid #334155; padding: 14px 20px; flex-shrink: 0; background: #1a2a1a;
  }
  .custom-entry-pane h3 {
    font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #4ade80; margin-bottom: 10px;
  }
  .custom-save-row {
    display: flex; align-items: center; gap: 14px; margin-top: 12px; padding-top: 10px;
    border-top: 1px solid #334155;
  }
  .custom-summary {
    font-size: 13px; color: #94a3b8; font-weight: 600;
  }

  .preview-label {
    font-size: 12px; color: #64748b; margin-bottom: 12px; text-align: center;
  }
  .preview-label strong { color: #e2e8f0; }

  /* scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: #475569; }

  /* Category colors */
  .cat-protein { background-color: #4ade80; }
  .cat-dairy { background-color: #60a5fa; }
  .cat-grain { background-color: #fbbf24; }
  .cat-fruit { background-color: #f472b6; }
  .cat-veg { background-color: #34d399; }
  .cat-fat { background-color: #fb923c; }
  .cat-legume { background-color: #a78bfa; }
  .cat-nut { background-color: #d97706; }
  .cat-condiment { background-color: #f87171; }
  .cat-bev { background-color: #38bdf8; }
</style>
</head>
<body>
<div class="app" id="app"></div>

<script>
// ============================================================
// INGREDIENT DATABASE — 100 common ingredients with macros per gram
// calories (kcal/g), protein (g/g), carbs (g/g), fat (g/g)
// ============================================================
const ingredients = [
  // PROTEIN (15)
  { id:1,  name:"Chicken Breast", cat:"protein", per_g:{cal:1.65,pro:0.31,carb:0,fat:0.036}, amounts:[{label:"3 oz",g:85},{label:"4 oz",g:113},{label:"6 oz",g:170},{label:"8 oz",g:227},{label:"1 breast (~7oz)",g:200}] },
  { id:2,  name:"Ground Beef (85/15)", cat:"protein", per_g:{cal:2.15,pro:0.265,carb:0,fat:0.15}, amounts:[{label:"3 oz",g:85},{label:"4 oz (patty)",g:113},{label:"6 oz",g:170},{label:"8 oz",g:227}] },
  { id:3,  name:"Salmon Fillet", cat:"protein", per_g:{cal:2.08,pro:0.20,carb:0,fat:0.13}, amounts:[{label:"3 oz",g:85},{label:"4 oz",g:113},{label:"6 oz fillet",g:170},{label:"8 oz fillet",g:227}] },
  { id:4,  name:"Eggs (whole)", cat:"protein", per_g:{cal:1.55,pro:0.126,carb:0.007,fat:0.11}, amounts:[{label:"1 large",g:50},{label:"2 large",g:100},{label:"3 large",g:150},{label:"4 large",g:200}] },
  { id:5,  name:"Turkey Breast", cat:"protein", per_g:{cal:1.35,pro:0.30,carb:0,fat:0.01}, amounts:[{label:"3 oz",g:85},{label:"4 oz",g:113},{label:"6 oz",g:170}] },
  { id:6,  name:"Shrimp", cat:"protein", per_g:{cal:0.99,pro:0.24,carb:0,fat:0.003}, amounts:[{label:"3 oz",g:85},{label:"6 oz",g:170},{label:"8 large (~3oz)",g:85},{label:"1 lb peeled",g:340}] },
  { id:7,  name:"Tuna (canned)", cat:"protein", per_g:{cal:1.16,pro:0.257,carb:0,fat:0.008}, amounts:[{label:"1 can (5oz)",g:142},{label:"½ can",g:71},{label:"3 oz",g:85}] },
  { id:8,  name:"Pork Chop", cat:"protein", per_g:{cal:1.97,pro:0.259,carb:0,fat:0.097}, amounts:[{label:"4 oz",g:113},{label:"6 oz chop",g:170},{label:"8 oz",g:227}] },
  { id:9,  name:"Ground Turkey", cat:"protein", per_g:{cal:1.70,pro:0.215,carb:0,fat:0.093}, amounts:[{label:"3 oz",g:85},{label:"4 oz",g:113},{label:"6 oz",g:170},{label:"8 oz",g:227}] },
  { id:10, name:"Bacon", cat:"protein", per_g:{cal:5.41,pro:0.37,carb:0,fat:0.42}, amounts:[{label:"1 slice",g:8},{label:"2 slices",g:16},{label:"3 slices",g:24},{label:"4 slices",g:32}] },
  { id:11, name:"Egg Whites", cat:"protein", per_g:{cal:0.52,pro:0.109,carb:0.007,fat:0.002}, amounts:[{label:"1 white",g:33},{label:"2 whites",g:66},{label:"3 whites",g:99},{label:"½ cup",g:122}] },
  { id:12, name:"Tilapia", cat:"protein", per_g:{cal:1.28,pro:0.26,carb:0,fat:0.023}, amounts:[{label:"3 oz",g:85},{label:"4 oz fillet",g:113},{label:"6 oz",g:170}] },
  { id:13, name:"Steak (Sirloin)", cat:"protein", per_g:{cal:1.83,pro:0.264,carb:0,fat:0.08}, amounts:[{label:"4 oz",g:113},{label:"6 oz",g:170},{label:"8 oz",g:227},{label:"12 oz",g:340}] },
  { id:14, name:"Deli Turkey", cat:"protein", per_g:{cal:1.04,pro:0.183,carb:0.036,fat:0.016}, amounts:[{label:"2 slices",g:56},{label:"4 slices",g:112},{label:"6 slices",g:168}] },
  { id:15, name:"Tofu (firm)", cat:"protein", per_g:{cal:0.83,pro:0.087,carb:0.02,fat:0.047}, amounts:[{label:"½ block",g:126},{label:"1 block",g:252},{label:"3 oz",g:85},{label:"½ cup cubed",g:126}] },

  // DAIRY (12)
  { id:16, name:"Whole Milk", cat:"dairy", per_g:{cal:0.61,pro:0.032,carb:0.048,fat:0.033}, amounts:[{label:"1 cup",g:244},{label:"½ cup",g:122},{label:"1 tbsp",g:15},{label:"2 cups",g:488}] },
  { id:17, name:"Greek Yogurt (plain)", cat:"dairy", per_g:{cal:0.59,pro:0.10,carb:0.036,fat:0.005}, amounts:[{label:"1 cup",g:245},{label:"¾ cup",g:184},{label:"½ cup",g:123},{label:"1 container (5.3oz)",g:150}] },
  { id:18, name:"Cheddar Cheese", cat:"dairy", per_g:{cal:4.03,pro:0.249,carb:0.013,fat:0.331}, amounts:[{label:"1 oz",g:28},{label:"1 slice",g:21},{label:"¼ cup shredded",g:28},{label:"½ cup shredded",g:57}] },
  { id:19, name:"Mozzarella", cat:"dairy", per_g:{cal:2.80,pro:0.222,carb:0.022,fat:0.174}, amounts:[{label:"1 oz",g:28},{label:"¼ cup shredded",g:28},{label:"½ cup shredded",g:57},{label:"1 slice",g:28}] },
  { id:20, name:"Cottage Cheese", cat:"dairy", per_g:{cal:0.98,pro:0.112,carb:0.034,fat:0.042}, amounts:[{label:"½ cup",g:113},{label:"1 cup",g:226},{label:"¼ cup",g:57}] },
  { id:21, name:"Butter", cat:"dairy", per_g:{cal:7.17,pro:0.009,carb:0.001,fat:0.811}, amounts:[{label:"1 pat",g:5},{label:"1 tbsp",g:14},{label:"2 tbsp",g:28},{label:"¼ cup (½ stick)",g:57}] },
  { id:22, name:"Cream Cheese", cat:"dairy", per_g:{cal:3.42,pro:0.059,carb:0.046,fat:0.342}, amounts:[{label:"1 tbsp",g:14},{label:"2 tbsp",g:29},{label:"1 oz",g:28}] },
  { id:23, name:"Parmesan", cat:"dairy", per_g:{cal:4.31,pro:0.357,carb:0.032,fat:0.286}, amounts:[{label:"1 tbsp grated",g:5},{label:"2 tbsp",g:10},{label:"1 oz",g:28}] },
  { id:24, name:"Heavy Cream", cat:"dairy", per_g:{cal:3.40,pro:0.021,carb:0.028,fat:0.365}, amounts:[{label:"1 tbsp",g:15},{label:"2 tbsp",g:30},{label:"¼ cup",g:60},{label:"½ cup",g:120}] },
  { id:25, name:"2% Milk", cat:"dairy", per_g:{cal:0.50,pro:0.034,carb:0.049,fat:0.020}, amounts:[{label:"1 cup",g:244},{label:"½ cup",g:122},{label:"2 cups",g:488}] },
  { id:26, name:"Sour Cream", cat:"dairy", per_g:{cal:1.98,pro:0.024,carb:0.047,fat:0.19}, amounts:[{label:"1 tbsp",g:12},{label:"2 tbsp",g:24},{label:"¼ cup",g:58}] },
  { id:27, name:"Whey Protein Powder", cat:"dairy", per_g:{cal:3.80,pro:0.80,carb:0.10,fat:0.03}, amounts:[{label:"1 scoop (~30g)",g:30},{label:"2 scoops",g:60},{label:"½ scoop",g:15}] },

  // GRAINS & STARCHES (15)
  { id:28, name:"White Rice (cooked)", cat:"grain", per_g:{cal:1.30,pro:0.027,carb:0.282,fat:0.003}, amounts:[{label:"½ cup",g:93},{label:"1 cup",g:186},{label:"1½ cups",g:279},{label:"2 cups",g:372}] },
  { id:29, name:"Brown Rice (cooked)", cat:"grain", per_g:{cal:1.23,pro:0.027,carb:0.257,fat:0.01}, amounts:[{label:"½ cup",g:98},{label:"1 cup",g:195},{label:"1½ cups",g:293}] },
  { id:30, name:"Pasta (cooked)", cat:"grain", per_g:{cal:1.58,pro:0.058,carb:0.31,fat:0.009}, amounts:[{label:"½ cup",g:70},{label:"1 cup",g:140},{label:"2 cups",g:280}] },
  { id:31, name:"Bread (white)", cat:"grain", per_g:{cal:2.65,pro:0.09,carb:0.49,fat:0.032}, amounts:[{label:"1 slice",g:25},{label:"2 slices",g:50},{label:"3 slices",g:75}] },
  { id:32, name:"Bread (whole wheat)", cat:"grain", per_g:{cal:2.47,pro:0.13,carb:0.413,fat:0.036}, amounts:[{label:"1 slice",g:28},{label:"2 slices",g:56},{label:"3 slices",g:84}] },
  { id:33, name:"Oats (dry)", cat:"grain", per_g:{cal:3.89,pro:0.169,carb:0.661,fat:0.069}, amounts:[{label:"¼ cup",g:20},{label:"½ cup",g:40},{label:"¾ cup",g:60},{label:"1 cup",g:81}] },
  { id:34, name:"Tortilla (flour)", cat:"grain", per_g:{cal:3.12,pro:0.085,carb:0.52,fat:0.077}, amounts:[{label:"1 small (6\")",g:30},{label:"1 medium (8\")",g:45},{label:"1 large (10\")",g:64},{label:"1 burrito (12\")",g:90}] },
  { id:35, name:"Quinoa (cooked)", cat:"grain", per_g:{cal:1.20,pro:0.044,carb:0.214,fat:0.019}, amounts:[{label:"½ cup",g:93},{label:"1 cup",g:185},{label:"¼ cup",g:46}] },
  { id:36, name:"Potato", cat:"grain", per_g:{cal:0.77,pro:0.02,carb:0.173,fat:0.001}, amounts:[{label:"1 medium",g:150},{label:"1 large",g:300},{label:"½ medium",g:75},{label:"1 small",g:110}] },
  { id:37, name:"Sweet Potato", cat:"grain", per_g:{cal:0.86,pro:0.016,carb:0.202,fat:0.001}, amounts:[{label:"1 medium",g:130},{label:"1 large",g:200},{label:"½ medium",g:65},{label:"1 cup cubed",g:133}] },
  { id:38, name:"Bagel", cat:"grain", per_g:{cal:2.70,pro:0.105,carb:0.531,fat:0.013}, amounts:[{label:"1 mini",g:43},{label:"1 regular",g:85},{label:"1 large",g:130}] },
  { id:39, name:"English Muffin", cat:"grain", per_g:{cal:2.35,pro:0.082,carb:0.462,fat:0.016}, amounts:[{label:"1 muffin",g:57},{label:"½ muffin",g:29}] },
  { id:40, name:"Granola", cat:"grain", per_g:{cal:4.71,pro:0.105,carb:0.648,fat:0.196}, amounts:[{label:"¼ cup",g:30},{label:"½ cup",g:61},{label:"¾ cup",g:91},{label:"1 cup",g:122}] },
  { id:41, name:"Cornbread", cat:"grain", per_g:{cal:3.05,pro:0.063,carb:0.434,fat:0.118}, amounts:[{label:"1 piece",g:65},{label:"2 pieces",g:130}] },
  { id:42, name:"Couscous (cooked)", cat:"grain", per_g:{cal:1.12,pro:0.038,carb:0.231,fat:0.002}, amounts:[{label:"½ cup",g:79},{label:"1 cup",g:157}] },

  // FRUITS (12)
  { id:43, name:"Banana", cat:"fruit", per_g:{cal:0.89,pro:0.011,carb:0.228,fat:0.003}, amounts:[{label:"1 small",g:101},{label:"1 medium",g:118},{label:"1 large",g:136},{label:"½ banana",g:59}] },
  { id:44, name:"Apple", cat:"fruit", per_g:{cal:0.52,pro:0.003,carb:0.138,fat:0.002}, amounts:[{label:"1 small",g:149},{label:"1 medium",g:182},{label:"1 large",g:223},{label:"1 cup sliced",g:109}] },
  { id:45, name:"Blueberries", cat:"fruit", per_g:{cal:0.57,pro:0.007,carb:0.145,fat:0.003}, amounts:[{label:"½ cup",g:74},{label:"1 cup",g:148},{label:"¼ cup",g:37}] },
  { id:46, name:"Strawberries", cat:"fruit", per_g:{cal:0.32,pro:0.007,carb:0.077,fat:0.003}, amounts:[{label:"1 cup whole",g:144},{label:"½ cup sliced",g:83},{label:"5 large",g:90}] },
  { id:47, name:"Orange", cat:"fruit", per_g:{cal:0.47,pro:0.009,carb:0.118,fat:0.001}, amounts:[{label:"1 small",g:96},{label:"1 medium",g:131},{label:"1 large",g:184}] },
  { id:48, name:"Grapes", cat:"fruit", per_g:{cal:0.69,pro:0.007,carb:0.181,fat:0.002}, amounts:[{label:"½ cup",g:76},{label:"1 cup",g:151},{label:"small bunch (~20)",g:100}] },
  { id:49, name:"Avocado", cat:"fruit", per_g:{cal:1.60,pro:0.02,carb:0.085,fat:0.147}, amounts:[{label:"¼ avocado",g:50},{label:"½ avocado",g:100},{label:"1 whole",g:200},{label:"2 tbsp mashed",g:30}] },
  { id:50, name:"Mango", cat:"fruit", per_g:{cal:0.60,pro:0.008,carb:0.15,fat:0.004}, amounts:[{label:"½ cup",g:83},{label:"1 cup",g:165},{label:"1 whole",g:200}] },
  { id:51, name:"Pineapple", cat:"fruit", per_g:{cal:0.50,pro:0.005,carb:0.131,fat:0.001}, amounts:[{label:"½ cup chunks",g:78},{label:"1 cup",g:156},{label:"1 ring",g:56}] },
  { id:52, name:"Raisins", cat:"fruit", per_g:{cal:2.99,pro:0.031,carb:0.792,fat:0.005}, amounts:[{label:"1 tbsp",g:10},{label:"¼ cup",g:41},{label:"small box",g:43}] },
  { id:53, name:"Dried Cranberries", cat:"fruit", per_g:{cal:3.25,pro:0.002,carb:0.827,fat:0.014}, amounts:[{label:"2 tbsp",g:20},{label:"¼ cup",g:40},{label:"⅓ cup",g:53}] },
  { id:54, name:"Lemon Juice", cat:"fruit", per_g:{cal:0.22,pro:0.004,carb:0.066,fat:0.002}, amounts:[{label:"1 tbsp",g:15},{label:"juice of 1 lemon",g:48},{label:"¼ cup",g:61}] },

  // VEGETABLES (15)
  { id:55, name:"Broccoli", cat:"veg", per_g:{cal:0.34,pro:0.028,carb:0.066,fat:0.004}, amounts:[{label:"1 cup chopped",g:91},{label:"½ cup",g:46},{label:"1 stalk",g:150},{label:"2 cups",g:182}] },
  { id:56, name:"Spinach (raw)", cat:"veg", per_g:{cal:0.23,pro:0.029,carb:0.036,fat:0.004}, amounts:[{label:"1 cup",g:30},{label:"2 cups",g:60},{label:"3 cups (big salad)",g:90},{label:"½ cup cooked",g:90}] },
  { id:57, name:"Bell Pepper", cat:"veg", per_g:{cal:0.26,pro:0.01,carb:0.06,fat:0.002}, amounts:[{label:"½ pepper",g:60},{label:"1 medium",g:119},{label:"1 cup chopped",g:149}] },
  { id:58, name:"Onion", cat:"veg", per_g:{cal:0.40,pro:0.011,carb:0.093,fat:0.001}, amounts:[{label:"¼ cup diced",g:40},{label:"½ medium",g:55},{label:"1 medium",g:110},{label:"1 cup chopped",g:160}] },
  { id:59, name:"Tomato", cat:"veg", per_g:{cal:0.18,pro:0.009,carb:0.039,fat:0.002}, amounts:[{label:"1 small",g:91},{label:"1 medium",g:123},{label:"1 large",g:182},{label:"1 cup chopped",g:180}] },
  { id:60, name:"Carrots", cat:"veg", per_g:{cal:0.41,pro:0.009,carb:0.096,fat:0.002}, amounts:[{label:"1 medium",g:61},{label:"1 cup chopped",g:128},{label:"½ cup",g:64},{label:"10 baby carrots",g:100}] },
  { id:61, name:"Garlic", cat:"veg", per_g:{cal:1.49,pro:0.064,carb:0.331,fat:0.005}, amounts:[{label:"1 clove",g:3},{label:"2 cloves",g:6},{label:"3 cloves",g:9},{label:"1 tbsp minced",g:9}] },
  { id:62, name:"Cucumber", cat:"veg", per_g:{cal:0.15,pro:0.007,carb:0.036,fat:0.001}, amounts:[{label:"½ cup sliced",g:52},{label:"1 cup",g:104},{label:"1 medium",g:201}] },
  { id:63, name:"Mushrooms", cat:"veg", per_g:{cal:0.22,pro:0.031,carb:0.033,fat:0.003}, amounts:[{label:"½ cup sliced",g:35},{label:"1 cup",g:70},{label:"5 medium",g:84},{label:"8 oz package",g:227}] },
  { id:64, name:"Zucchini", cat:"veg", per_g:{cal:0.17,pro:0.012,carb:0.032,fat:0.003}, amounts:[{label:"1 small",g:113},{label:"1 medium",g:196},{label:"1 cup sliced",g:113}] },
  { id:65, name:"Lettuce (romaine)", cat:"veg", per_g:{cal:0.17,pro:0.012,carb:0.033,fat:0.003}, amounts:[{label:"1 cup shredded",g:47},{label:"2 cups",g:94},{label:"3 leaves",g:51}] },
  { id:66, name:"Kale", cat:"veg", per_g:{cal:0.49,pro:0.043,carb:0.089,fat:0.009}, amounts:[{label:"1 cup chopped",g:67},{label:"2 cups",g:134},{label:"1 bunch",g:190}] },
  { id:67, name:"Celery", cat:"veg", per_g:{cal:0.14,pro:0.007,carb:0.03,fat:0.002}, amounts:[{label:"1 stalk",g:40},{label:"2 stalks",g:80},{label:"1 cup chopped",g:101}] },
  { id:68, name:"Corn (canned)", cat:"veg", per_g:{cal:0.82,pro:0.025,carb:0.193,fat:0.005}, amounts:[{label:"½ cup",g:82},{label:"1 cup",g:164},{label:"1 ear",g:90}] },
  { id:69, name:"Green Beans", cat:"veg", per_g:{cal:0.31,pro:0.018,carb:0.07,fat:0.001}, amounts:[{label:"½ cup",g:63},{label:"1 cup",g:125},{label:"handful (~20 beans)",g:60}] },

  // FATS & OILS (8)
  { id:70, name:"Olive Oil", cat:"fat", per_g:{cal:8.84,pro:0,carb:0,fat:1.0}, amounts:[{label:"1 tsp",g:5},{label:"1 tbsp",g:14},{label:"2 tbsp",g:28}] },
  { id:71, name:"Coconut Oil", cat:"fat", per_g:{cal:8.62,pro:0,carb:0,fat:1.0}, amounts:[{label:"1 tsp",g:5},{label:"1 tbsp",g:14},{label:"2 tbsp",g:28}] },
  { id:72, name:"Mayonnaise", cat:"fat", per_g:{cal:6.80,pro:0.01,carb:0.01,fat:0.75}, amounts:[{label:"1 tsp",g:5},{label:"1 tbsp",g:14},{label:"2 tbsp",g:28}] },
  { id:73, name:"Ranch Dressing", cat:"fat", per_g:{cal:4.62,pro:0.01,carb:0.062,fat:0.475}, amounts:[{label:"1 tbsp",g:15},{label:"2 tbsp",g:30},{label:"¼ cup",g:60}] },
  { id:74, name:"Italian Dressing", cat:"fat", per_g:{cal:2.67,pro:0.003,carb:0.1,fat:0.247}, amounts:[{label:"1 tbsp",g:15},{label:"2 tbsp",g:30}] },
  { id:75, name:"Salsa", cat:"fat", per_g:{cal:0.36,pro:0.014,carb:0.074,fat:0.002}, amounts:[{label:"2 tbsp",g:32},{label:"¼ cup",g:65},{label:"½ cup",g:130}] },
  { id:76, name:"Guacamole", cat:"fat", per_g:{cal:1.50,pro:0.02,carb:0.08,fat:0.13}, amounts:[{label:"2 tbsp",g:32},{label:"¼ cup",g:60},{label:"½ cup",g:120}] },
  { id:77, name:"Hummus", cat:"fat", per_g:{cal:1.66,pro:0.081,carb:0.143,fat:0.097}, amounts:[{label:"2 tbsp",g:30},{label:"¼ cup",g:62},{label:"⅓ cup",g:82}] },

  // LEGUMES (7)
  { id:78, name:"Black Beans (canned)", cat:"legume", per_g:{cal:0.91,pro:0.062,carb:0.162,fat:0.004}, amounts:[{label:"½ cup",g:130},{label:"1 cup",g:260},{label:"¼ cup",g:65}] },
  { id:79, name:"Chickpeas (canned)", cat:"legume", per_g:{cal:1.19,pro:0.064,carb:0.198,fat:0.021}, amounts:[{label:"½ cup",g:120},{label:"1 cup",g:240},{label:"¼ cup",g:60}] },
  { id:80, name:"Lentils (cooked)", cat:"legume", per_g:{cal:1.16,pro:0.09,carb:0.201,fat:0.004}, amounts:[{label:"½ cup",g:99},{label:"1 cup",g:198},{label:"¼ cup",g:50}] },
  { id:81, name:"Kidney Beans", cat:"legume", per_g:{cal:1.27,pro:0.089,carb:0.225,fat:0.005}, amounts:[{label:"½ cup",g:128},{label:"1 cup",g:256}] },
  { id:82, name:"Edamame", cat:"legume", per_g:{cal:1.21,pro:0.119,carb:0.084,fat:0.052}, amounts:[{label:"½ cup shelled",g:78},{label:"1 cup shelled",g:155},{label:"1 cup in pods",g:155}] },
  { id:83, name:"Peanut Butter", cat:"legume", per_g:{cal:5.88,pro:0.252,carb:0.20,fat:0.504}, amounts:[{label:"1 tbsp",g:16},{label:"2 tbsp",g:32},{label:"1 tsp",g:5}] },
  { id:84, name:"Refried Beans", cat:"legume", per_g:{cal:0.98,pro:0.058,carb:0.152,fat:0.012}, amounts:[{label:"½ cup",g:126},{label:"1 cup",g:252},{label:"¼ cup",g:63}] },

  // NUTS & SEEDS (8)
  { id:85, name:"Almonds", cat:"nut", per_g:{cal:5.79,pro:0.212,carb:0.216,fat:0.498}, amounts:[{label:"1 oz (~23)",g:28},{label:"¼ cup",g:36},{label:"½ cup",g:72},{label:"10 almonds",g:12}] },
  { id:86, name:"Walnuts", cat:"nut", per_g:{cal:6.54,pro:0.152,carb:0.137,fat:0.654}, amounts:[{label:"1 oz (~14 halves)",g:28},{label:"¼ cup chopped",g:30},{label:"½ cup",g:59}] },
  { id:87, name:"Cashews", cat:"nut", per_g:{cal:5.53,pro:0.183,carb:0.304,fat:0.438}, amounts:[{label:"1 oz (~18)",g:28},{label:"¼ cup",g:32},{label:"½ cup",g:65}] },
  { id:88, name:"Chia Seeds", cat:"nut", per_g:{cal:4.86,pro:0.169,carb:0.422,fat:0.308}, amounts:[{label:"1 tbsp",g:12},{label:"2 tbsp",g:24},{label:"¼ cup",g:40}] },
  { id:89, name:"Flax Seeds (ground)", cat:"nut", per_g:{cal:5.34,pro:0.183,carb:0.289,fat:0.423}, amounts:[{label:"1 tbsp",g:7},{label:"2 tbsp",g:14},{label:"¼ cup",g:28}] },
  { id:90, name:"Sunflower Seeds", cat:"nut", per_g:{cal:5.84,pro:0.207,carb:0.20,fat:0.514}, amounts:[{label:"1 oz",g:28},{label:"¼ cup",g:33},{label:"2 tbsp",g:18}] },
  { id:91, name:"Pecans", cat:"nut", per_g:{cal:6.91,pro:0.092,carb:0.139,fat:0.72}, amounts:[{label:"1 oz (~19 halves)",g:28},{label:"¼ cup",g:27},{label:"½ cup",g:55}] },
  { id:92, name:"Pumpkin Seeds", cat:"nut", per_g:{cal:5.59,pro:0.302,carb:0.108,fat:0.492}, amounts:[{label:"1 oz",g:28},{label:"2 tbsp",g:18},{label:"¼ cup",g:32}] },

  // CONDIMENTS & MISC (8)
  { id:93, name:"Honey", cat:"condiment", per_g:{cal:3.04,pro:0.003,carb:0.824,fat:0}, amounts:[{label:"1 tsp",g:7},{label:"1 tbsp",g:21},{label:"2 tbsp",g:42}] },
  { id:94, name:"Maple Syrup", cat:"condiment", per_g:{cal:2.60,pro:0.001,carb:0.672,fat:0.001}, amounts:[{label:"1 tbsp",g:20},{label:"2 tbsp",g:40},{label:"¼ cup",g:80}] },
  { id:95, name:"Ketchup", cat:"condiment", per_g:{cal:1.12,pro:0.013,carb:0.276,fat:0.001}, amounts:[{label:"1 tbsp",g:17},{label:"2 tbsp",g:34},{label:"1 packet",g:10}] },
  { id:96, name:"Soy Sauce", cat:"condiment", per_g:{cal:0.53,pro:0.076,carb:0.049,fat:0.001}, amounts:[{label:"1 tsp",g:6},{label:"1 tbsp",g:18},{label:"2 tbsp",g:36}] },
  { id:97, name:"BBQ Sauce", cat:"condiment", per_g:{cal:1.72,pro:0.008,carb:0.408,fat:0.006}, amounts:[{label:"1 tbsp",g:17},{label:"2 tbsp",g:34},{label:"¼ cup",g:68}] },
  { id:98, name:"Hot Sauce", cat:"condiment", per_g:{cal:0.11,pro:0.007,carb:0.017,fat:0.004}, amounts:[{label:"1 tsp",g:5},{label:"1 tbsp",g:15},{label:"2 tbsp",g:30}] },
  { id:99, name:"Sugar (white)", cat:"condiment", per_g:{cal:3.87,pro:0,carb:1.0,fat:0}, amounts:[{label:"1 tsp",g:4},{label:"1 tbsp",g:12},{label:"¼ cup",g:50},{label:"½ cup",g:100}] },
  { id:100, name:"Dark Chocolate (70%)", cat:"condiment", per_g:{cal:5.98,pro:0.079,carb:0.459,fat:0.427}, amounts:[{label:"1 square",g:10},{label:"1 oz",g:28},{label:"2 squares",g:20}] },
];

const catLabels = {
  protein:"Protein", dairy:"Dairy", grain:"Grains & Starches", fruit:"Fruit",
  veg:"Vegetables", fat:"Fats & Oils", legume:"Legumes", nut:"Nuts & Seeds", condiment:"Condiments"
};

// ============================================================
// APP STATE
// ============================================================
let state = {
  selectedIngredient: null,
  selectedAmount: null,
  dailyItems: [],
  searchQuery: "",
  panelWidth: 680,
  profile: { sex: null, height: null, weight: null, age: null, goal: null, activity: null },
  custom: { cal: null, pro: null, carb: null, fat: null }
};

const heightOptions = [
  {label:"5'0\"", cm:152}, {label:"5'2\"", cm:157}, {label:"5'4\"", cm:163},
  {label:"5'6\"", cm:168}, {label:"5'8\"", cm:173}, {label:"5'10\"", cm:178},
  {label:"6'0\"", cm:183}, {label:"6'2\"", cm:188}, {label:"6'4\"", cm:193}, {label:"6'6\"", cm:198},
];
const weightOptions = [100, 120, 140, 160, 180, 200, 225, 250, 275, 300];
const ageOptions = [20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80];

// ============================================================
// LOCAL STORAGE — persist state across sessions
// ============================================================
function saveState() {
  try {
    const toSave = { dailyItems: state.dailyItems, profile: state.profile, panelWidth: state.panelWidth };
    localStorage.setItem('macroTrackerState', JSON.stringify(toSave));
  } catch(e) {}
}

function loadState() {
  try {
    const saved = localStorage.getItem('macroTrackerState');
    if (!saved) return;
    const parsed = JSON.parse(saved);
    if (parsed.dailyItems) state.dailyItems = parsed.dailyItems;
    if (parsed.profile) state.profile = parsed.profile;
    if (parsed.panelWidth) state.panelWidth = parsed.panelWidth;
  } catch(e) {}
}

loadState();

// Activity multipliers (Harris-Benedict)
const activityOptions = [
  { key: 'sedentary',  label: 'Sedentary',           mult: 1.2  },
  { key: 'light',      label: 'Lightly Active',      mult: 1.375 },
  { key: 'moderate',   label: 'Moderately Active',   mult: 1.55 },
  { key: 'very',       label: 'Very Active',         mult: 1.725 },
  { key: 'extra',      label: 'Extra Active',        mult: 1.9  },
];

const goalOptions = [
  { key: 'cut_fast',  label: 'Aggressive Cut',  offset: -500 },
  { key: 'cut_slow',  label: 'Moderate Cut',    offset: -250 },
  { key: 'maintain',  label: 'Maintain',         offset: 0    },
  { key: 'bulk_slow', label: 'Lean Bulk',        offset: 250  },
  { key: 'bulk_fast', label: 'Aggressive Bulk',  offset: 500  },
];

// Mifflin-St Jeor BMR → TDEE → goal-adjusted → protein-per-lb macro split
function calcDailyTargets() {
  const p = state.profile;
  if (!p.sex || !p.height || !p.weight || !p.age || !p.goal || !p.activity) return null;
  const wKg = p.weight * 0.4536;
  const hCm = p.height; // now actual height in cm
  const age = p.age;

  // Mifflin-St Jeor: BMR = 10m + 6.25h - 5a + s
  let bmr = 10 * wKg + 6.25 * hCm - 5 * age;
  bmr += p.sex === 'male' ? 5 : -161;

  const actMult = activityOptions.find(a => a.key === p.activity).mult;
  const goalOff = goalOptions.find(g => g.key === p.goal).offset;
  const goalCal = Math.round(bmr * actMult + goalOff);

  // Protein: 1g per lb body weight (evidence-based for body composition)
  const proGrams = Math.round(p.weight * 1.0);
  const proCal = proGrams * 4;

  // Remaining calories split ~55% carbs / ~45% fat
  const remaining = Math.max(0, goalCal - proCal);
  const carbGrams = Math.round((remaining * 0.55) / 4);
  const fatGrams = Math.round((remaining * 0.45) / 9);

  return { cal: goalCal, pro: proGrams, carb: carbGrams, fat: fatGrams };
}

function calcMacros(ingredient, grams) {
  const p = ingredient.per_g;
  return {
    cal: Math.round(p.cal * grams),
    pro: Math.round(p.pro * grams * 10) / 10,
    carb: Math.round(p.carb * grams * 10) / 10,
    fat: Math.round(p.fat * grams * 10) / 10
  };
}

function getTotals() {
  return state.dailyItems.reduce((t, item) => {
    t.cal += item.macros.cal;
    t.pro += item.macros.pro;
    t.carb += item.macros.carb;
    t.fat += item.macros.fat;
    return t;
  }, { cal: 0, pro: 0, carb: 0, fat: 0 });
}

function getFilteredIngredients() {
  if (!state.searchQuery) return ingredients;
  const q = state.searchQuery.toLowerCase();
  return ingredients.filter(i => i.name.toLowerCase().includes(q) || catLabels[i.cat].toLowerCase().includes(q));
}

// ============================================================
// RENDER
// ============================================================
function render() {
  const app = document.getElementById('app');
  const filtered = getFilteredIngredients();
  const totals = getTotals();
  const sel = state.selectedIngredient;
  const amt = state.selectedAmount;
  let preview = null;
  if (sel && amt) {
    preview = calcMacros(sel, amt.g);
  }

  app.innerHTML = `
    <!-- LEFT: Daily Tracker -->
    <div class="daily-panel" id="dailyPanel" style="width:${state.panelWidth}px">
      <div class="resize-handle" id="resizeHandle"></div>
      <h2>Daily Tracker</h2>
      <div class="daily-items">
        ${state.dailyItems.length === 0 ? `
          <div class="empty-state">
            <div class="icon">&#127858;</div>
            <p>No items logged yet.<br>Select an ingredient and amount to get started.</p>
          </div>
        ` : state.dailyItems.map((item, i) => `
          <div class="daily-item">
            <div>
              <div class="item-name">${item.name}</div>
              <div class="item-amount">${item.amountLabel} (${item.grams}g)</div>
            </div>
            <div class="item-macros">
              <span class="macro-cal">${item.macros.cal}</span>
              <span class="macro-pro">${item.macros.pro}p</span>
              <span class="macro-carb">${item.macros.carb}c</span>
              <span class="macro-fat">${item.macros.fat}f</span>
            </div>
            <button class="remove-btn" data-remove="${i}">&times;</button>
          </div>
        `).join('')}
      </div>
      <div class="daily-totals">
        <h3>Daily Totals</h3>
        <div class="totals-grid">
          <div class="total-box total-cal">
            <div class="total-label">Calories</div>
            <div class="total-value">${totals.cal}</div>
          </div>
          <div class="total-box total-pro">
            <div class="total-label">Protein</div>
            <div class="total-value">${Math.round(totals.pro * 10) / 10}g</div>
          </div>
          <div class="total-box total-carb">
            <div class="total-label">Carbs</div>
            <div class="total-value">${Math.round(totals.carb * 10) / 10}g</div>
          </div>
          <div class="total-box total-fat">
            <div class="total-label">Fat</div>
            <div class="total-value">${Math.round(totals.fat * 10) / 10}g</div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="right-panel">
      <!-- TOP PANE -->
      <div class="top-pane">
        <!-- Ingredient List -->
        <div class="ingredient-list">
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search ingredients..." value="${state.searchQuery}" />
          </div>
          <div class="ingredient-scroll">
            ${filtered.map(ing => `
              <button class="ingredient-btn${sel && sel.id === ing.id ? ' active' : ''}" data-id="${ing.id}">
                <span class="cat-dot cat-${ing.cat}"></span>${ing.name}
              </button>
            `).join('')}
          </div>
        </div>

        <!-- Amounts -->
        <div class="amount-panel">
          ${sel ? `
            <div class="amount-header">
              <h3>Select Amount</h3>
              <div class="sel-name">${sel.name}</div>
            </div>
            <div class="amount-scroll">
              ${sel.amounts.map((a, i) => `
                <button class="amount-btn${amt && amt === a ? ' active' : ''}" data-amt="${i}">
                  <span class="amt-label">${a.label}</span>
                  <span class="amt-grams">${a.g}g</span>
                </button>
              `).join('')}
            </div>
          ` : `<div class="no-selection">&#8592; Select an ingredient</div>`}
        </div>
      </div>

      <!-- BOTTOM PANE — Macro Preview + Save -->
      <div class="bottom-pane">
        ${preview ? `
          <div class="preview-label">
            <strong>${sel.name}</strong> &mdash; ${amt.label} (${amt.g}g)
          </div>
          <div class="macro-preview">
            <div class="macro-card mc-cal">
              <div class="mc-label">Calories</div>
              <div class="mc-value">${preview.cal}</div>
              <div class="mc-unit">kcal</div>
            </div>
            <div class="macro-card mc-pro">
              <div class="mc-label">Protein</div>
              <div class="mc-value">${preview.pro}</div>
              <div class="mc-unit">grams</div>
            </div>
            <div class="macro-card mc-carb">
              <div class="mc-label">Carbs</div>
              <div class="mc-value">${preview.carb}</div>
              <div class="mc-unit">grams</div>
            </div>
            <div class="macro-card mc-fat">
              <div class="mc-label">Fat</div>
              <div class="mc-value">${preview.fat}</div>
              <div class="mc-unit">grams</div>
            </div>
          </div>
          <button class="save-btn" id="saveBtn">Save to Daily Tracker</button>
        ` : `
          <div class="bottom-empty">
            Select an ingredient and amount to preview macros
            <div class="hint">Macros will appear here</div>
          </div>
        `}
      </div>

      <!-- CUSTOM MACRO ENTRY -->
      <div class="custom-entry-pane">
        <h3>Quick Add Custom Item</h3>
        <div class="profile-row">
          <span class="profile-row-label">Calories</span>
          <div class="pill-group">
            ${[50,100,150,200,250,300,400,500,600,800,1000].map(v => `
              <button class="pill-btn${state.custom.cal === v ? ' active' : ''}" data-custom="cal" data-val="${v}">${v}</button>
            `).join('')}
          </div>
        </div>
        <div class="profile-row">
          <span class="profile-row-label">Protein</span>
          <div class="pill-group">
            ${[0,5,10,15,20,25,30,40,50].map(v => `
              <button class="pill-btn${state.custom.pro === v ? ' active' : ''}" data-custom="pro" data-val="${v}">${v}g</button>
            `).join('')}
          </div>
        </div>
        <div class="profile-row">
          <span class="profile-row-label">Carbs</span>
          <div class="pill-group">
            ${[0,5,10,15,20,25,30,40,50,75,100].map(v => `
              <button class="pill-btn${state.custom.carb === v ? ' active' : ''}" data-custom="carb" data-val="${v}">${v}g</button>
            `).join('')}
          </div>
        </div>
        <div class="profile-row">
          <span class="profile-row-label">Fat</span>
          <div class="pill-group">
            ${[0,5,10,15,20,25,30,40,50].map(v => `
              <button class="pill-btn${state.custom.fat === v ? ' active' : ''}" data-custom="fat" data-val="${v}">${v}g</button>
            `).join('')}
          </div>
        </div>
        <div class="custom-save-row">
          <button class="save-btn" id="customSaveBtn" ${state.custom.cal === null ? 'disabled' : ''}>Add Custom to Tracker</button>
          ${state.custom.cal !== null ? `<span class="custom-summary">${state.custom.cal} cal, ${state.custom.pro || 0}p, ${state.custom.carb || 0}c, ${state.custom.fat || 0}f</span>` : ''}
        </div>
      </div>

      <!-- PROFILE & GOALS PANE -->
      <div class="profile-pane">
        <h3>Profile & Daily Targets</h3>
        <div class="profile-row">
          <span class="profile-row-label">Sex</span>
          <div class="pill-group">
            <button class="pill-btn${state.profile.sex === 'male' ? ' active' : ''}" data-profile="sex" data-val="male">Male</button>
            <button class="pill-btn${state.profile.sex === 'female' ? ' active' : ''}" data-profile="sex" data-val="female">Female</button>
          </div>
        </div>
        <div class="profile-row">
          <span class="profile-row-label">Height</span>
          <div class="pill-group">
            ${heightOptions.map(h => `
              <button class="pill-btn${state.profile.height === h.cm ? ' active' : ''}" data-profile="height" data-val="${h.cm}">${h.label}</button>
            `).join('')}
          </div>
        </div>
        <div class="profile-row">
          <span class="profile-row-label">Weight</span>
          <div class="pill-group">
            ${weightOptions.map(w => `
              <button class="pill-btn${state.profile.weight === w ? ' active' : ''}" data-profile="weight" data-val="${w}">${w}</button>
            `).join('')}
          </div>
        </div>
        <div class="profile-row">
          <span class="profile-row-label">Age</span>
          <div class="pill-group">
            ${ageOptions.map(a => `
              <button class="pill-btn${state.profile.age === a ? ' active' : ''}" data-profile="age" data-val="${a}">${a}</button>
            `).join('')}
          </div>
        </div>
        <div class="profile-row">
          <span class="profile-row-label">Goal</span>
          <div class="pill-group">
            ${goalOptions.map(g => `
              <button class="pill-btn${state.profile.goal === g.key ? ' active' : ''}" data-profile="goal" data-val="${g.key}">${g.label}</button>
            `).join('')}
          </div>
        </div>
        <div class="profile-row">
          <span class="profile-row-label">Activity</span>
          <div class="pill-group">
            ${activityOptions.map(a => `
              <button class="pill-btn${state.profile.activity === a.key ? ' active' : ''}" data-profile="activity" data-val="${a.key}">${a.label}</button>
            `).join('')}
          </div>
        </div>
        ${(() => {
          const targets = calcDailyTargets();
          if (!targets) return '<div class="target-note">Fill in all fields to see your daily macro targets</div>';
          return `
            <div class="target-display">
              <div class="target-chip tc-cal"><div class="tc-label">Calories</div><div class="tc-value">${targets.cal}</div><div class="tc-unit">kcal/day</div></div>
              <div class="target-chip tc-pro"><div class="tc-label">Protein</div><div class="tc-value">${targets.pro}g</div><div class="tc-unit">~30%</div></div>
              <div class="target-chip tc-carb"><div class="tc-label">Carbs</div><div class="tc-value">${targets.carb}g</div><div class="tc-unit">~40%</div></div>
              <div class="target-chip tc-fat"><div class="tc-label">Fat</div><div class="tc-value">${targets.fat}g</div><div class="tc-unit">~30%</div></div>
            </div>
            <div class="target-note">Mifflin-St Jeor BMR &bull; Protein: 1g/lb body weight &bull; Remaining cal: 55% carbs, 45% fat</div>
          `;
        })()}
      </div>
    </div>
  `;

  bindEvents();
  initResize();
  saveState();
}

// ============================================================
// EVENT BINDING
// ============================================================
function bindEvents() {
  // Search
  const searchInput = document.getElementById('searchInput');
  if (searchInput) {
    searchInput.addEventListener('input', e => {
      state.searchQuery = e.target.value;
      render();
      // refocus and restore cursor
      const inp = document.getElementById('searchInput');
      inp.focus();
      inp.setSelectionRange(inp.value.length, inp.value.length);
    });
  }

  // Ingredient buttons
  document.querySelectorAll('.ingredient-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = parseInt(btn.dataset.id);
      state.selectedIngredient = ingredients.find(i => i.id === id);
      state.selectedAmount = null;
      render();
    });
  });

  // Amount buttons
  document.querySelectorAll('.amount-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const idx = parseInt(btn.dataset.amt);
      state.selectedAmount = state.selectedIngredient.amounts[idx];
      render();
    });
  });

  // Save button
  const saveBtn = document.getElementById('saveBtn');
  if (saveBtn) {
    saveBtn.addEventListener('click', () => {
      const sel = state.selectedIngredient;
      const amt = state.selectedAmount;
      if (!sel || !amt) return;
      state.dailyItems.push({
        name: sel.name,
        amountLabel: amt.label,
        grams: amt.g,
        macros: calcMacros(sel, amt.g)
      });
      state.selectedAmount = null;
      render();
    });
  }

  // Custom macro pill buttons
  document.querySelectorAll('.pill-btn[data-custom]').forEach(btn => {
    btn.addEventListener('click', () => {
      const field = btn.dataset.custom;
      const val = parseInt(btn.dataset.val);
      state.custom[field] = state.custom[field] === val ? null : val; // toggle
      render();
    });
  });

  // Custom save button
  const customSaveBtn = document.getElementById('customSaveBtn');
  if (customSaveBtn) {
    customSaveBtn.addEventListener('click', () => {
      if (state.custom.cal === null) return;
      state.dailyItems.push({
        name: 'Custom Item',
        amountLabel: 'manual',
        grams: 0,
        macros: {
          cal: state.custom.cal || 0,
          pro: state.custom.pro || 0,
          carb: state.custom.carb || 0,
          fat: state.custom.fat || 0
        }
      });
      state.custom = { cal: null, pro: null, carb: null, fat: null };
      render();
    });
  }

  // Profile pill buttons
  document.querySelectorAll('.pill-btn[data-profile]').forEach(btn => {
    btn.addEventListener('click', () => {
      const field = btn.dataset.profile;
      const val = btn.dataset.val;
      // weight, height, and age are numeric
      state.profile[field] = (field === 'weight' || field === 'age' || field === 'height') ? parseInt(val) : val;
      render();
    });
  });

  // Remove buttons
  document.querySelectorAll('.remove-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const idx = parseInt(btn.dataset.remove);
      state.dailyItems.splice(idx, 1);
      render();
    });
  });
}

// ============================================================
// RESIZE HANDLE — drag to resize left panel
// ============================================================
function initResize() {
  const handle = document.getElementById('resizeHandle');
  const panel = document.getElementById('dailyPanel');
  if (!handle || !panel) return;

  let startX, startWidth, dragging = false;

  handle.addEventListener('mousedown', e => {
    e.preventDefault();
    dragging = true;
    startX = e.clientX;
    startWidth = panel.offsetWidth;
    handle.classList.add('active');
    document.body.style.cursor = 'col-resize';
    document.body.style.userSelect = 'none';
  });

  document.addEventListener('mousemove', e => {
    if (!dragging) return;
    const delta = e.clientX - startX;
    const newWidth = Math.max(280, Math.min(window.innerWidth * 0.8, startWidth + delta));
    panel.style.width = newWidth + 'px';
    state.panelWidth = newWidth;
  });

  document.addEventListener('mouseup', () => {
    if (!dragging) return;
    dragging = false;
    handle.classList.remove('active');
    document.body.style.cursor = '';
    document.body.style.userSelect = '';
    saveState();
  });
}

// Initial render
render();
initResize();
</script>
</body>
</html>
